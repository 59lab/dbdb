## Vulnerability Title

There is a cross-site scripting(XSS) vulnerability in the QuestDB database

## Affected Versions:  

V9.2.3(latest)

## Discovery Time:  

2026-01-05

## Discoverer:  

59LAB(59lab@mchz.com.cn)

## Analysis Report: 

installed:
docker run -p 9000:9000 -p 9009:9009 -p 8812:8812 questdb/questdb
<img width="1481" height="784" alt="image" src="https://github.com/user-attachments/assets/640cd9bd-45f5-4aae-b5a1-f9dd5eea28e5" />

## POC
http://192.168.150.33:9000/index.html
POC: select '<iframe src="data:text/html,<script>alert(1)</script>"></iframe>'
<img width="1408" height="689" alt="image" src="https://github.com/user-attachments/assets/9847f949-b953-4bcc-867e-4be26d2299bc" />
<img width="1867" height="1024" alt="image" src="https://github.com/user-attachments/assets/86722936-ab17-4eb2-bbe7-36257db85347" />


## Patch Solution:
To remediate this vulnerability, it is recommended to apply a defense-in-depth approach combining proper output encoding and stricter security policy enforcement:
Strict Output Encoding
All data returned from SQL query results and rendered in the web interface should be properly HTML-encoded according to its output context. Special characters such as <, >, ", and ' must be safely escaped to prevent user-controlled input from being interpreted as HTML markup.
Restrict Dangerous URI Schemes
The application should explicitly block or sanitize dangerous URI schemes such as data:, javascript:, and blob: when rendering content inside HTML attributes or tags (e.g., iframe, img, object, embed). Allowlisting only trusted schemes like https: is strongly recommended.
Harden Content Security Policy (CSP)
The existing Content Security Policy should be strengthened to prevent script execution from non-trusted sources. In particular:
Disallow data: URIs in frame-src, child-src, and script-src
Avoid using 'unsafe-inline' and 'unsafe-eval'
Enforce a strict default-src 'self' policy
Avoid Rendering Raw Query Results as HTML
SQL execution console output should be rendered as plain text rather than raw HTML whenever possible. If HTML rendering is required, a robust HTML sanitizer should be applied to remove executable elements such as <script>, <iframe>, <svg>, and event handler attributes.
By implementing the above measures, the risk of cross-site scripting (XSS), including CSP bypass techniques using data: URLs, can be effectively mitigated.
